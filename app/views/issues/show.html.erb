<p id="notice"><%= notice %></p>
<div class="ui container">
  <% if @parent_name == "Course" %>
    <% @issue_path = course_issue_path(@parent.id, @issue.parent_issue_id) %>
  <% end %>
  <div id="issue_title">
    <div class="ui huge label">
      #<%= @issue.parent_issue_id %>
    </div>
    <div class="ui huge header" id="issue_title_text">
      <%= @issue.title %>
    </div>
  </div>
  <div class="ui labeled action huge input" id="issue_title_input">
    <div class="ui label">
      #<%= @issue.parent_issue_id %>
    </div>
    <input type="string" placeholder="<%= @issue.title %>" id="issue_title_string">
    <div class="ui button title_save_button" id="<%= @issue_path %>">저장</div>
    <div class="ui button" id="issue_title_cancle_button">취소</div>
  </div>

  <div class="ui divider"></div>
  <div class="ui button" id="issue_edit_button">제목 수정</div>
  <%= link_to subscribe_course_issue_path(@parent.id, @issue.parent_issue_id) do %>
    <button class="ui button" ><%= @subscribe_button_text %></button>
  <% end %>

  <div class="ui divider"></div>
  <div class="ui comments">
    <% @comments.each_with_index do |comment, index| %>
      <% if @parent_name == "Course" %>
        <% @comment_path = course_issue_comment_path(@parent.id, @issue.parent_issue_id, comment.id) %>
      <% end %>
      <div class="comment" id="comment_<%= index %>">
        <div class="content">
          <a class="author">
            <% user = User.find(comment.commenter) %>
            <%= user.name %>
          </a>
          <div class="text" id="comment_text_<%= index %>">
            <% unless comment.contents.nil? %>
              <% text = render_issue_link(comment.contents) %>
              <% text = render_easy_link(text) %>
              <% text = render_latex_math(text) %>
              <% text = text.gsub(/\\\$/) do '$' end %>
              <% text = escape_script_tag(text) %>
              <%= render_markdown(text) %>
            <% end %>
          </div>
	      <div class="actions">
            <a class="edit_button" id="comment_edit_button_<%= index %>#<%= @comment_path %>" do>수정</a>
            <a class="delete">
              <%= link_to '삭제', @comment_path, method: :delete, data: {confirm: 'Are you sure?' } %>
            </a>
          </div>
        </div>
      </div>
      <div class="ui form comment_edit" id="comment_edit_<%= index %>">
        <div class="field">
          <textarea id="edit_text_<%= index %>"></textarea>
        </div>
        <div class="ui button edit_save_button" id="edit_save_<%= index %>#<%= @comment_path %>">저장</div>
        <div class="ui button edit_cancle_button" id="edit_cancle_<%= index %>">취소</div>
      </div>
      <div class="ui divider"></div>
    <% end %>
  </div>

  <%= form_for([@issue, @issue.comments.create], url: @comments_path) do |f| %>
    <div class="ui form">
      <div class="field">
        <%= f.hidden_field :commenter, :value => current_user.id %>
      </div>
      <div class="field">
        <%= f.label :comments %><br />
        <%= f.text_area :contents, required: true %>
      </div>
      <div class="actions">
        <%= f.submit '작성하기', class: 'ui submit button' %>
      </div>
    </div>
  <% end %>

  <div class="ui divider"></div>
  <%= link_to @index_path do %>
    <div class="ui button">돌아가기</div>
  <% end %>
  <%= link_to @issue_path, method: :delete, data: { confirm: '정말 삭제하시겠습니까?' } do %>
    <div class="ui button">이슈 삭제</div>
  <% end %>
</div>

<script>
  $(document).on('ready page:load', documentLoad());
  $("#issue_edit_button").click(issueTitleEdit);
  $("#issue_title_cancle_button").click(issueTitleCancle);
  $(".title_save_button").click(issueTitleSave);
  $(".edit_button").click(commentEdit);
  $(".edit_save_button").click(commentSave);
  $(".edit_cancle_button").click(commentCancle);
</script>
